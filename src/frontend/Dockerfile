# –≠—Ç–∞–ø —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
FROM node:20 AS build
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º package.json –∏ package-lock.json
COPY package.json package-lock.json ./

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π package-lock.json (–µ—Å–ª–∏ –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç macOS-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
RUN rm -f package-lock.json

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–≥–æ –¥–ª—è Linux
RUN npm install --force --legacy-peer-deps

# –ü–µ—Ä–µ–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏
ARG VITE_REACT_APP_BACKEND_URL
ENV VITE_REACT_APP_BACKEND_URL=${VITE_REACT_APP_BACKEND_URL}

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
COPY . .

# –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
RUN npm run build

FROM nginx:alpine AS production

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥ Nginx
# üìå –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥ Nginx –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ø–∫—É `/etc/nginx/conf.d/`
COPY nginx.conf /etc/nginx/conf.d/default.conf

# üìå –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–±—Ä–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Nginx
COPY --from=build /app/dist /usr/share/nginx/html

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç
EXPOSE 80

# –ó–∞–ø—É—Å–∫–∞–µ–º Nginx
CMD ["nginx", "-g", "daemon off;"]